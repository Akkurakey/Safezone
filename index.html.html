<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Safe Zone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --crt-text: #86efac;
            --crt-bg: #050505;
            --scanline-color: rgba(18, 16, 16, 0.5);
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'VT323', monospace;
            overflow: hidden;
            color: var(--crt-text);
        }

        /* TV Set Structure */
        .tv-set {
            width: 90vw;
            max-width: 800px;
            height: 70vh;
            max-height: 600px;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 
                inset 0 0 20px #000,
                0 0 50px rgba(0,0,0,0.8),
                0 20px 30px rgba(0,0,0,0.5);
            position: relative;
            border: 8px solid #333;
        }

        /* Screen Area */
        .screen {
            width: 100%;
            height: 100%;
            background-color: var(--crt-bg);
            border-radius: 40px; 
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        /* CRT Visual Effects */
        .crt-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 10;
            pointer-events: none;
            background: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
            background-size: 100% 4px, 6px 100%;
            animation: scanline 10s linear infinite;
        }
        
        .crt-flicker {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(18, 16, 16, 0.1);
            z-index: 11;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.02; }
            50% { opacity: 0.05; }
            100% { opacity: 0.02; }
        }
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        /* UI Elements */
        .ui-container {
            z-index: 5;
            text-align: center;
            width: 80%;
            transition: opacity 0.5s ease;
        }

        h1 {
            font-size: 3rem;
            text-shadow: 0 0 10px var(--crt-text), 2px 2px 0px #ff00de;
            margin-bottom: 2rem;
            letter-spacing: 2px;
            font-weight: normal;
        }

        .input-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--crt-text);
            color: white;
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            text-align: center;
            width: 120px;
            outline: none;
            text-shadow: 0 0 5px white;
        }
        input::placeholder { color: rgba(134, 239, 172, 0.3); }

        button {
            background: transparent;
            border: 2px solid var(--crt-text);
            color: var(--crt-text);
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            padding: 10px 30px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--crt-text);
            transition: all 0.3s;
        }
        button:hover {
            background: var(--crt-text);
            color: #000;
            box-shadow: 0 0 20px var(--crt-text);
        }

        /* Loading / Noise */
        .noise-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            opacity: 0;
            background-image: url('data:image/svg+xml,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noise"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noise)" opacity="1"/%3E%3C/svg%3E');
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .noise-active {
            opacity: 0.6; 
            animation: noiseShimmy 0.1s infinite;
        }
        @keyframes noiseShimmy {
            0% { transform: translate(0,0) scale(1.1); }
            100% { transform: translate(5px, 5px) scale(1.1); }
        }

        /* Result View */
        .result-view {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 2s ease;
            z-index: 4;
        }

        .result-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            z-index: 1;
            /* Slightly lighter filter to make image clearer */
            filter: sepia(20%) contrast(105%) brightness(85%) blur(0.5px);
        }

        /* Updated Message Style - No Border */
        .message {
            position: relative;
            z-index: 6;
            font-size: 2.5rem; /* Increased size */
            color: var(--crt-text);
            padding: 0;
            margin-bottom: 30px;
            border: none; /* Removed border */
            background: transparent; /* Removed background */
            box-shadow: none; /* Removed box shadow */
            
            text-align: center;
            width: 90%;
            
            /* Strong Text Shadow to ensure readability on any background */
            text-shadow: 
                2px 2px 0px #000, 
                -1px -1px 0 #000,  
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000,
                0 0 15px rgba(134, 239, 172, 0.8);
            
            animation: floatText 4s ease-in-out infinite;
        }
        
        @keyframes floatText {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .reset-btn {
            margin-top: 10px; 
            z-index: 6; 
            font-size: 1rem; 
            border: 1px solid var(--crt-text);
            background: rgba(0,0,0,0.5); /* Slight BG for button visibility */
            padding: 5px 15px;
        }

        /* Power Light */
        .power-light {
            position: absolute;
            bottom: 15px; right: 40px;
            width: 8px; height: 8px;
            background-color: #333;
            border-radius: 50%;
            transition: all 0.5s;
            box-shadow: 0 0 2px #000;
        }
        .power-light.on {
            background-color: #0f0;
            box-shadow: 0 0 15px #0f0;
        }
        .power-light.processing {
            background-color: #ff9900;
            box-shadow: 0 0 15px #ff9900;
            animation: blink 0.5s infinite;
        }

        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.3;} 100% {opacity: 1;} }

    </style>
</head>
<body>

    <div class="tv-set">
        <div class="screen">
            <div class="crt-overlay"></div>
            <div class="crt-flicker"></div>
            
            <!-- Noise Layer -->
            <div class="noise-overlay" id="noise"></div>

            <!-- Input View -->
            <div class="ui-container" id="input-ui">
                <h1>// SAFE ZONE PROTOCOL</h1>
                <div style="margin-bottom: 20px; opacity: 0.7; font-size: 1.2rem;">INPUT 3 MEMORIES (KEYWORDS)</div>
                <div class="input-group">
                    <input type="text" id="key1" placeholder="Place" autocomplete="off" maxlength="15">
                    <input type="text" id="key2" placeholder="Time" autocomplete="off" maxlength="15">
                    <input type="text" id="key3" placeholder="Feeling" autocomplete="off" maxlength="15">
                </div>
                <button onclick="startGeneration()">INITIALIZE</button>
            </div>

            <!-- Result View -->
            <div class="result-view" id="result-ui">
                <img src="" alt="" class="result-bg" id="result-img">
                <div class="message" id="result-text"></div>
                <button class="reset-btn" onclick="resetTV()">[ WAKE UP ]</button>
            </div>
        </div>
        <div class="power-light" id="pwr-light"></div>
    </div>

    <!-- Audio: Using a stable Archive.org link for ambient dreamcore music (Gymnopedie style ambient) -->
    <audio id="bgm" loop>
        <source src="https://archive.org/download/gymnopedie-no-1/Gymnopedie_No_1.mp3" type="audio/mp3">
    </audio>

    <script>
        const bgm = document.getElementById('bgm');
        // Lower volume for ambient feel
        bgm.volume = 0.4; 

        function startGeneration() {
            // 1. Get Inputs
            const k1 = document.getElementById('key1').value.trim() || 'clouds';
            const k2 = document.getElementById('key2').value.trim() || 'nostalgia';
            const k3 = document.getElementById('key3').value.trim() || 'safe';

            const noise = document.getElementById('noise');
            const inputUi = document.getElementById('input-ui');
            const resultUi = document.getElementById('result-ui');
            const resultImg = document.getElementById('result-img');
            const pwrLight = document.getElementById('pwr-light');

            // 2. Handle Audio & State
            // IMPORTANT: Browsers block audio unless user interacted. This function runs on click, so it works.
            bgm.play().then(() => {
                console.log("Audio playing");
            }).catch(error => {
                console.log("Audio play failed (browser policy or network):", error);
            });

            pwrLight.classList.remove('on');
            pwrLight.classList.add('processing');
            
            inputUi.style.opacity = '0';
            inputUi.style.pointerEvents = 'none';
            noise.classList.add('noise-active');

            // 3. Construct Prompt
            // Adding dreamcore specific styling keywords
            const styleKeywords = "dreamcore, weirdcore, liminal space, soft lighting, grain, low fidelity, 90s aesthetic, ethereal";
            const finalPrompt = `${k1} ${k2} ${k3}, ${styleKeywords}`;
            
            // 4. Generate Image URL (Pollinations AI)
            const aiImageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(finalPrompt)}?width=800&height=600&nologo=true&seed=${Math.floor(Math.random()*9999)}`;

            // 5. Preload Image
            const imgLoader = new Image();
            imgLoader.src = aiImageUrl;
            
            imgLoader.onload = () => {
                resultImg.src = aiImageUrl;
                
                // Short delay for effect
                setTimeout(() => {
                    noise.classList.remove('noise-active');
                    resultUi.style.opacity = '1';
                    resultUi.style.pointerEvents = 'all';
                    
                    pwrLight.classList.remove('processing');
                    pwrLight.classList.add('on');
                    
                    generateText();
                }, 1500);
            };

            // Fallback if AI takes too long (> 6 seconds)
            setTimeout(() => {
                if (resultUi.style.opacity !== '1') {
                    // Use a reliable Unsplash dreamcore backup
                    resultImg.src = "https://images.unsplash.com/photo-1487621867583-18f6c0805d21?q=80&w=800&auto=format&fit=crop";
                    noise.classList.remove('noise-active');
                    resultUi.style.opacity = '1';
                    resultUi.style.pointerEvents = 'all';
                    pwrLight.classList.remove('processing');
                    pwrLight.classList.add('on');
                    generateText();
                }
            }, 6000);
        }

        function generateText() {
            const phrases = [
                "You have been here before.",
                "The pain doesn't exist here.",
                "Don't wake up yet.",
                "The world is quiet.",
                "A memory preserved forever.",
                "Safe inside the screen.",                
                "You have been here before.",
                "Playtime is eternal.",
                "Rest your eyes, the simulation is paused.",
                "Stay longer.",
                "You are safe in the static.",
                "Can you hear the silence?",
                "Buffering reality..."
            ];
            document.getElementById('result-text').innerText = phrases[Math.floor(Math.random() * phrases.length)];
        }

        function resetTV() {
            const inputUi = document.getElementById('input-ui');
            const resultUi = document.getElementById('result-ui');
            const noise = document.getElementById('noise');
            
            noise.classList.add('noise-active');
            resultUi.style.opacity = '0';
            resultUi.style.pointerEvents = 'none';
            document.getElementById('pwr-light').classList.remove('on');

            setTimeout(() => {
                noise.classList.remove('noise-active');
                inputUi.style.opacity = '1';
                inputUi.style.pointerEvents = 'all';
                
                document.getElementById('key1').value = '';
                document.getElementById('key2').value = '';
                document.getElementById('key3').value = '';
                document.getElementById('result-img').src = '';
                
                // Optional: Stop music on reset
                // bgm.pause();
                // bgm.currentTime = 0;
            }, 800);
        }
    </script>
</body>
</html>